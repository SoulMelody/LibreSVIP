<iframe allow="camera; geolocation; microphone; fullscreen; autoplay; encrypted-media; picture-in-picture; clipboard-read; clipboard-write" class="marimo-embed" frameborder="0" height="600px" src="https://marimo.app/?code=import+marimo%0Aapp+%3D+marimo.App%28width%3D%22wide%22%29%0A%0A%40app.cell%0Aasync+def+_%28%29%3A%0A++++try%3A%0A++++++++import+micropip%0A++++++++micropip.add_mock_package%28%27packaging%27%2C+%2725.0%27%29%0A%0A++++++++await+micropip.install%28%22https%3A%2F%2Fwww.piwheels.org%2Fsimple%2Fconstruct%2Fconstruct-2.10.68-py3-none-any.whl%22%29%0A++++++++await+micropip.install%28%22https%3A%2F%2Fwww.piwheels.org%2Fsimple%2Fjyutping%2Fjyutping-0.3.4-py2.py3-none-any.whl%22%29%0A++++++++await+micropip.install%28%22https%3A%2F%2Fwww.piwheels.org%2Fsimple%2Fmido-fix%2Fmido_fix-1.2.12-py2.py3-none-any.whl%22%29%0A++++++++await+micropip.install%28%22https%3A%2F%2Fwww.piwheels.org%2Fsimple%2Fwanakana-python%2Fwanakana_python-1.2.2-py3-none-any.whl%22%29%0A++++++++await+micropip.install%28%22ruamel-yaml%22%29%0A++++++++await+micropip.install%28%22lxml%22%29%0A%0A++++++++await+micropip.install%28%22zstandard%22%29%0A++++++++micropip.add_mock_package%28%27zstandard%27%2C+%270.23.0%27%29%0A%0A++++++++micropip.add_mock_package%28%27pydantic%27%2C+%272.11.7%27%29%0A++++++++micropip.add_mock_package%28%27pydantic-core%27%2C+%272.33.2%27%29%0A++++++++micropip.add_mock_package%28%27typing-extensions%27%2C+%274.14.0%27%29%0A%0A++++++++await+micropip.install%28%22pycryptodome%22%29%0A++++++++micropip.add_mock_package%28%27pycryptodomex%27%2C+%223.23.0%22%29%0A++++++++await+micropip.install%28%22pyzipper%22%29%0A%0A++++++++await+micropip.install%28%22libresvip%22%29%0A++++++++micropip.remove_mock_package%28%27packaging%27%29%0A++++++++micropip.remove_mock_package%28%27pycryptodomex%27%29%0A++++++++micropip.remove_mock_package%28%27pydantic%27%29%0A++++++++micropip.remove_mock_package%28%27pydantic-core%27%29%0A++++++++micropip.remove_mock_package%28%27typing-extensions%27%29%0A++++++++micropip.remove_mock_package%28%27zstandard%27%29%0A++++except+ImportError%3A%0A++++++++pass%0A++++return+%28micropip%2C%29%0A%0A%40app.cell%0Adef+_%28%29%3A%0A++++import+marimo+as+mo%0A++++return+%28mo%2C%29%0A%0A%40app.cell%0Adef+_%28mo%29%3A%0A++++from+libresvip.core.config+import+Language%2C+settings%0A++++from+libresvip.extension.manager+import+get_translation%0A++++from+libresvip.utils+import+translation%0A++++from+libresvip.utils.translation+import+gettext_lazy+as+_%0A%0A++++def+on_change_language%28value%3A+str%29%3A%0A++++++++if+value+%3D%3D+%22%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87%22%3A%0A++++++++++++settings.language+%3D+Language.CHINESE%0A++++++++else%3A%0A++++++++++++settings.language+%3D+Language.ENGLISH%0A++++++++translation.singleton_translation+%3D+get_translation%28%29%0A%0A++++language_select+%3D+mo.ui.dropdown%28%0A++++++++%5B%27English%27%2C+%27%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87%27%5D%2C%0A++++++++label%3D%22Language%2F%E8%AF%AD%E8%A8%80%22%2C%0A++++++++on_change%3Don_change_language%0A++++%29%0A++++language_select%0A++++return+%28%0A++++++++Language%2C%0A++++++++get_translation%2C%0A++++++++language_select%2C%0A++++++++on_change_language%2C%0A++++++++settings%2C%0A++++++++translation%2C%0A++++%29%0A%0A%40app.cell%0Adef+_%28mo%29%3A%0A++++import+enum%0A++++from+functools+import+partial%0A++++from+typing+import+Any%2C+get_args%2C+get_type_hints%0A%0A++++from+pydantic+import+BaseModel%0A++++from+pydantic_core+import+PydanticUndefined%0A++++from+pydantic_extra_types.color+import+Color%0A%0A++++from+libresvip.model.base+import+BaseComplexModel%0A++++from+libresvip.utils.translation+import+gettext_lazy+as+_%0A%0A++++def+generate_model_json_schema%28option_class%3A+type%5BBaseModel%5D%29+-%3E+tuple%5Bdict%5Bstr%2C+Any%5D%2C+mo.vstack%5D%3A%0A++++++++option_dict+%3D+%7B%7D%0A++++++++for+option_key%2C+field_info+in+option_class.model_fields.items%28%29%3A%0A++++++++++++default_value+%3D+None+if+field_info.default+is+PydanticUndefined+else+field_info.default%0A++++++++++++if+issubclass%28field_info.annotation%2C+bool%29%3A%0A++++++++++++++++option_dict%5Boption_key%5D+%3D+mo.ui.switch%28%0A++++++++++++++++++++value%3Ddefault_value%2C%0A++++++++++++++++++++label%3D_%28field_info.title%29%2C%0A++++++++++++++++%29%0A++++++++++++elif+issubclass%28field_info.annotation%2C+enum.Enum%29%3A%0A++++++++++++++++annotations+%3D+get_type_hints%28field_info.annotation%2C+include_extras%3DTrue%29%0A++++++++++++++++choices+%3D+%7B%7D%0A++++++++++++++++for+enum_item+in+field_info.annotation%3A%0A++++++++++++++++++++if+enum_item.name+in+annotations%3A%0A++++++++++++++++++++++++annotated_args+%3D+list%28%0A++++++++++++++++++++++++++++get_args%28annotations%5Benum_item.name%5D%29%2C%0A++++++++++++++++++++++++%29%0A++++++++++++++++++++++++if+len%28annotated_args%29+%3E%3D+2%3A%0A++++++++++++++++++++++++++++enum_field+%3D+annotated_args%5B1%5D%0A++++++++++++++++++++++++else%3A%0A++++++++++++++++++++++++++++continue%0A++++++++++++++++++++++++choices%5B_%28enum_field.title%29%5D+%3D+enum_item.value%0A++++++++++++++++++++++++if+isinstance%28default_value%2C+enum.Enum%29+and+default_value.name+%3D%3D+enum_item.name%3A%0A++++++++++++++++++++++++++++default_value+%3D+_%28enum_field.title%29%0A++++++++++++++++option_dict%5Boption_key%5D+%3D+mo.ui.dropdown%28%0A++++++++++++++++++++choices%2C%0A++++++++++++++++++++value%3Ddefault_value%2C%0A++++++++++++++++++++label%3D_%28field_info.title%29%2C%0A++++++++++++++++%29%0A++++++++++++elif+issubclass%28field_info.annotation%2C+int%29%3A%0A++++++++++++++++option_dict%5Boption_key%5D+%3D+mo.ui.number%28%0A++++++++++++++++++++value%3Ddefault_value%2C%0A++++++++++++++++++++label%3D_%28field_info.title%29%2C%0A++++++++++++++++%29%0A++++++++++++elif+issubclass%28field_info.annotation%2C+float%29%3A%0A++++++++++++++++option_dict%5Boption_key%5D+%3D+mo.ui.number%28%0A++++++++++++++++++++value%3Ddefault_value%2C%0A++++++++++++++++++++label%3D_%28field_info.title%29%2C%0A++++++++++++++++%29%0A++++++++++++else%3A%0A++++++++++++++++if+issubclass%28field_info.annotation%2C+BaseComplexModel%29%3A%0A++++++++++++++++++++default_value+%3D+field_info.annotation.default_repr%28%29%0A++++++++++++++++option_dict%5Boption_key%5D+%3D+mo.ui.text%28%0A++++++++++++++++++++value%3Ddefault_value%2C%0A++++++++++++++++++++label%3D_%28field_info.title%29%2C%0A++++++++++++++++%29%0A++++++++return+option_dict%2C+mo.vstack%28list%28option_dict.values%28%29%29%29%0A++++return+%28%0A++++++++Any%2C%0A++++++++BaseComplexModel%2C%0A++++++++BaseModel%2C%0A++++++++Color%2C%0A++++++++PydanticUndefined%2C%0A++++++++enum%2C%0A++++++++generate_model_json_schema%2C%0A++++++++get_args%2C%0A++++++++get_type_hints%2C%0A++++++++partial%2C%0A++++%29%0A%0A%40app.cell%0Adef+_%28language_select%2C+mo%29%3A%0A++++from+libresvip.extension.manager+import+plugin_manager%0A++++from+libresvip.utils.translation+import+gettext_lazy+as+_%0A%0A++++mo.stop%28language_select.value+is+None%2C+mo.md%28%22%22%29%29%0A%0A++++format_choices+%3D+%7B%0A++++++++_%28plugin.file_format+or+%22%22%29+%2B+f%22+%28%2A.%7Bplugin.suffix%7D%29%22%3A+identifier%0A++++++++for+identifier%2C+plugin+in+plugin_manager.plugin_registry.items%28%29%0A++++%7D%0A++++input_format_select+%3D+mo.ui.dropdown%28%0A++++++++format_choices%2C%0A++++++++label%3D_%28%22Import+format%22%29%2C%0A++++%29%0A++++output_format_select+%3D+mo.ui.dropdown%28%0A++++++++format_choices%2C%0A++++++++label%3D_%28%22Export+format%22%29%2C%0A++++%29%0A%0A++++mo.vstack%28%5B%0A++++++++input_format_select%2C%0A++++++++output_format_select%0A++++%5D%29%0A++++return+input_format_select%2C+output_format_select%2C+plugin_manager%0A%0A%40app.cell%0Adef+_%28%0A++++generate_model_json_schema%2C%0A++++get_type_hints%2C%0A++++input_format_select%2C%0A++++language_select%2C%0A++++mo%2C%0A++++output_format_select%2C%0A++++plugin_manager%2C%0A%29%3A%0A++++from+libresvip.utils.translation+import+gettext_lazy+as+_%0A++++mo.stop%28language_select.value+is+None+or+input_format_select.value+is+None+or+output_format_select.value+is+None%2C+mo.md%28%22%22%29%29%0A%0A++++input_plugin+%3D+plugin_manager.plugin_registry%5Binput_format_select.value%5D%0A++++input_options_cls+%3D+get_type_hints%28input_plugin.plugin_object.load%29%5B%22options%22%5D%0A++++input_options_dict%2C+input_options_form+%3D+generate_model_json_schema%28input_options_cls%29%0A++++output_plugin+%3D+plugin_manager.plugin_registry%5Boutput_format_select.value%5D%0A++++output_options_cls+%3D+get_type_hints%28output_plugin.plugin_object.dump%29%5B%22options%22%5D%0A++++output_options_dict%2C+output_options_form+%3D+generate_model_json_schema%28output_options_cls%29%0A++++tabs+%3D+mo.ui.tabs%28%7B%0A++++++++_%28%22Input+Options%22%29%3A+input_options_form%2C%0A++++++++_%28%22Output+Options%22%29%3A+output_options_form%2C%0A++++%7D%29%0A++++tabs%0A++++return+%28%0A++++++++input_options_cls%2C%0A++++++++input_options_dict%2C%0A++++++++input_options_form%2C%0A++++++++input_plugin%2C%0A++++++++output_options_cls%2C%0A++++++++output_options_dict%2C%0A++++++++output_options_form%2C%0A++++++++output_plugin%2C%0A++++++++tabs%2C%0A++++%29%0A%0A%40app.cell%0Adef+_%28input_format_select%2C+language_select%2C+mo%2C+output_format_select%29%3A%0A++++from+libresvip.utils.translation+import+gettext_lazy+as+_%0A++++mo.stop%28language_select.value+is+None+or+input_format_select.value+is+None+or+output_format_select.value+is+None%2C+mo.md%28%22%22%29%29%0A%0A++++f+%3D+mo.ui.file%28label%3D_%28%22Drag+and+drop+files+here+or+click+to+upload%22%29%2C+kind%3D%22area%22%29%0A++++btn+%3D+mo.ui.run_button%28label%3D_%28%22Start+Conversion%22%29%29%0A++++mo.vstack%28%5B%0A++++++++f%2C%0A++++++++btn%2C%0A++++%5D%29%0A++++return+btn%2C+f%0A%0A%40app.cell%0Adef+_%28%0A++++btn%2C%0A++++f%2C%0A++++input_options_cls%2C%0A++++input_options_dict%2C%0A++++input_plugin%2C%0A++++mo%2C%0A++++output_format_select%2C%0A++++output_options_cls%2C%0A++++output_options_dict%2C%0A++++output_plugin%2C%0A%29%3A%0A++++import+pathlib%0A++++import+tempfile%0A%0A++++from+libresvip.utils.translation+import+gettext_lazy+as+_%0A%0A++++mo.stop%28f.contents%280%29+is+None+or+btn.value+is+False%2C+mo.md%28%22%22%29%29%0A%0A++++temp_path+%3D+pathlib.Path%28tempfile.mkdtemp%28%29%29%0A%0A++++input_file_data+%3D+f.value%5B0%5D%0A++++input_option+%3D+input_options_cls.model_validate%28%7B%0A++++++++k%3A+v.value+for+k%2C+v+in+input_options_dict.items%28%29%0A++++%7D%29%0A++++output_option+%3D+output_options_cls.model_validate%28%7B%0A++++++++k%3A+v.value+for+k%2C+v+in+output_options_dict.items%28%29%0A++++%7D%29%0A++++has_error+%3D+False%0A++++cur_dir+%3D+pathlib.Path%28%22.%22%29%0A++++child_file+%3D+%28temp_path+%2F+input_file_data.name%29%0A++++child_file.write_bytes%28input_file_data.contents%29%0A++++target_file+%3D+%28cur_dir+%2F+input_file_data.name%29.with_suffix%28f%22.%7Boutput_format_select.value%7D%22%29%0A++++project+%3D+input_plugin.plugin_object.load%28child_file%2C+input_option%29%0A++++output_plugin.plugin_object.dump%28target_file%2C+project%2C+output_option%29%0A++++mo.download%28%0A++++++++data%3Dtarget_file.read_bytes%28%29%2C%0A++++++++filename%3Dtarget_file.name%2C%0A++++++++mimetype%3D%22application%2Foctet-stream%22%2C%0A++++++++label%3D_%28%22Export%22%29%2C%0A++++%29%0A++++return+%28%0A++++++++child_file%2C%0A++++++++cur_dir%2C%0A++++++++has_error%2C%0A++++++++input_file_data%2C%0A++++++++input_option%2C%0A++++++++output_option%2C%0A++++++++pathlib%2C%0A++++++++project%2C%0A++++++++target_file%2C%0A++++++++temp_path%2C%0A++++++++tempfile%2C%0A++++%29&amp;embed=true&amp;mode=read&amp;include-code=false" style="display: block; margin: 0 auto;" width="100%"></iframe>